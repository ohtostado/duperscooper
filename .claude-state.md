# Claude Development State - duperscooper

**Last Updated:** 2025-10-08
**Current Branch:** feature/gui-staging-management
**Latest Commit:** 0a95c87 (feat: add dual-pane viewer and remove obsolete UI files)
**Latest PR:** #18 (Dual-Pane Viewer - Open/WIP)

## Quick Reference

- **Project:** Python CLI + GUI for finding duplicate audio files
- **Tech Stack:** Python 3.8+, PySide6, SQLite, Chromaprint/ffprobe
- **Quality:** Black (88 chars), Ruff, MyPy strict
- **Git Remote:** git@github-ohtostado:ohtostado/duperscooper.git
- **Main Branch:** `main`

## Current Status: GUI Dual-Pane Interface (Phase 3)

### ðŸš§ Active Work: PR #18 - Dual-Pane Viewer (WIP)

**What's Done:**
- âœ… `DualPaneViewer` class with full type annotations (mypy clean)
- âœ… `RealtimeScanner` background thread for real-time results
- âœ… `StagingQueue` data model
- âœ… `dual_pane_widget.ui` Qt Designer layout
- âœ… Removed obsolete files (old main_window.ui, results_widget.ui, results_viewer.py)
- âœ… All code quality checks passing

**What's Next:**
1. **Backend Integration** (Current Priority)
   - Connect RealtimeScanner to actual CLI backend
   - Wire up deletion signals to StagingManager
   - Implement scan cancellation
   - Test real-time group display

2. **Main Window Integration**
   - Replace old tabs with DualPaneViewer
   - Update menu actions and lifecycle
   - Test full workflow

### File Structure (GUI)

```
src/duperscooper_gui/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ settings.py          # Platform-specific config loader
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ default_config.toml
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ results_model.py     # Scan results data model
â”‚   â””â”€â”€ staging_queue.py     # NEW: Staging queue tracker
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ dual_pane_widget.ui  # NEW: Dual-pane layout
â”‚   â”œâ”€â”€ main_window_new.ui   # NEW: Simplified main window
â”‚   â””â”€â”€ staging_widget.ui
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ backend_interface.py # CLI subprocess wrapper
â”‚   â””â”€â”€ realtime_scanner.py  # NEW: Background scan thread
â””â”€â”€ windows/
    â”œâ”€â”€ dual_pane_viewer.py  # NEW: Main dual-pane UI
    â”œâ”€â”€ main_window.py       # Simplified (WIP)
    â””â”€â”€ staging_viewer.py
```

## Next Phase: Polish & Settings (Phase 4)

**After backend integration is complete:**
- Settings/preferences dialog
- Keyboard shortcuts
- Drag & drop for paths
- Window size/position persistence

## Development Commands

```bash
# Quality checks (must pass before commit)
.venv/bin/black src/
.venv/bin/ruff check --fix src/
.venv/bin/mypy src/

# Run GUI
.venv/bin/duperscooper-gui

# Edit UI
pyside6-designer src/duperscooper_gui/ui/dual_pane_widget.ui

# Test CLI
.venv/bin/duperscooper test-albums/  # Album mode (default)
.venv/bin/duperscooper --track-mode test-audio/  # Track mode
```

## Key Architecture

### CLI Backend (Complete)
- **Album Mode:** Default, matches by MusicBrainz ID â†’ fingerprints
- **Track Mode:** Perceptual matching via Chromaprint
- **Staging:** UUID-based `.deletedByDuperscooper/` with manifests
- **Output:** JSON with `recommended_action` for GUI integration

### GUI Frontend (In Progress)
- **DualPaneViewer:** Single-view scan + results + staging
- **RealtimeScanner:** Emits groups as they're found during scan
- **Settings:** TOML config at `~/.config/duperscooper/duperscooper-gui-options.toml`

## Important Notes

- **Read CLAUDE-HISTORICAL-PLANS.md** for completed features and background
- **Read CLAUDE-GUI-DUAL-PANE-PLAN.md** for detailed dual-pane design
- **Always format** with Black before committing
- **Reference files** using markdown links: `[file.py](src/duperscooper/file.py)`

## Quick Links

- **Historical Plans:** [CLAUDE-HISTORICAL-PLANS.md](CLAUDE-HISTORICAL-PLANS.md)
- **Dual-Pane Design:** [CLAUDE-GUI-DUAL-PANE-PLAN.md](CLAUDE-GUI-DUAL-PANE-PLAN.md)
- **Project Instructions:** [CLAUDE.md](CLAUDE.md)
- **GitHub:** https://github.com/ohtostado/duperscooper
- **Latest PR:** https://github.com/ohtostado/duperscooper/pull/18
